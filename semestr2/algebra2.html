<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1"
      crossorigin="anonymous"
    />

    <link rel="stylesheet" href="../main.css" />

    <title>Шпаргалка алгебра</title>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
      <div class="container-fluid">
        <a class="navbar-brand" href="/">РКБО-01-20</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item dropdown active">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                id="navbarDropdown"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                Алгебра
              </a>
              <ul
                class="dropdown-menu"
                aria-labelledby="navbarDropdown"
                id="navbar"
              ></ul>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="matan.html">Матан</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <main class="container">
      <div class="text-center py-5 px-3">
        <h1>Сессия по линейной алгебре</h1>
        <p class="lead">Шпоры и калькуляторы для сдачи алгебры.<br /></p>
      </div>

      <div class="row gy-5">
        <!--Determinator-->
        <div>
          <div class="row">
            <h2 id="deter">Вычисление определителя</h2>
            <div class="col">
              <div class="card">
                <div class="card-body">
                  <div class="input-group mb-3">
                    <span class="input-group-text" id="basic-addon1"
                      >Размер матрицы</span
                    >
                    <select
                      class="form-select"
                      aria-label="Размер матрицы"
                      id="deter_mat_size"
                      for="deter_mat_table"
                      onchange="fillSquareMat(this)"
                    >
                      <option value="1">1x1</option>
                      <option value="2">2x2</option>
                      <option value="3" selected="selected">3x3</option>
                      <option value="4">4x4</option>
                      <option value="5">5x5</option>
                      <option value="6">6x6</option>
                      <option value="7">7x7</option>
                    </select>
                  </div>

                  <div class="mb-3">
                    <label for="deter_mat_table" class="form-label"
                      >Матрица</label
                    >
                    <div class="md-0" id="deter_mat_table"></div>
                  </div>

                  <div class="input-group mb-3">
                    <span class="input-group-text">Δ</span>
                    <input
                      type="text"
                      id="deter_result"
                      class="form-control"
                      disabled
                    />
                    <button
                      type="submit"
                      class="btn btn-primary"
                      onclick="calcDet()"
                    >
                      Вычислить
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!--Determinator with param-->
        <div>
          <div class="row">
            <h2 id="deter_param">Решение определителя с параметром</h2>
            <div class="col">
              <div class="card">
                <div class="card-body">
                  <p class="card-text">
                    Вычисление параметра определителя средствами Wolfram|Alpha. Параметр указывается любой удобной буквой.
                    По нажатию кнопки тебя редиректнит на страницу вольфрама с
                    решением.
                  </p>
                  <div class="input-group mb-3">
                    <span class="input-group-text" id="basic-addon1"
                      >Размер матрицы</span
                    >

                    <select
                      class="form-select"
                      aria-label="Размер матрицы"
                      id="deter_param_mat_size"
                      for="deter_param_mat_table"
                      onchange="fillSquareMat(this)"
                    >
                      <option value="1">1x1</option>
                      <option value="2">2x2</option>
                      <option value="3" selected="selected">3x3</option>
                      <option value="4">4x4</option>
                      <option value="5">5x5</option>
                      <option value="6">6x6</option>
                      <option value="7">7x7</option>
                    </select>
                  </div>

                  <div class="input-group mb-3">
                    <span class="input-group-text">Δ=</span>
                    <input
                      type="text"
                      id="deter_param_result"
                      class="form-control"
                      value="0"
                    />
                  </div>

                  <div class="mb-3">
                    <label for="deter_param_mat_table" class="form-label"
                      >Матрица</label
                    >
                    <div class="md-0" id="deter_param_mat_table"></div>
                  </div>

                  <div class="input-group mb-3">
                    <button
                      type="submit"
                      class="btn btn-primary"
                      onclick="calcDetWithParam()"
                    >
                      Вычислить
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!--Multi-->
        <div>
          <div class="row">
            <h2 id="multi">Умножение матриц</h2>
            <div class="col">
              <div class="card">
                <div class="card-body">
                  <div class="input-group mb-3">
                    <span class="input-group-text" id="basic-addon1"
                      >Кол-во матриц для перемножения</span
                    >
                    <select
                      class="form-select"
                      aria-label="Размер матрицы"
                      id="multi_mats_number"
                      for="multi_mats"
                      onchange="fillMultiMats(this)"
                    >
                      <option value="2" selected="selected">2</option>
                      <option value="3">3</option>
                      <option value="4">4</option>
                      <option value="5">5</option>
                      <option value="6">6</option>
                      <option value="7">7</option>
                    </select>
                  </div>

                  <div id="multi_mats"></div>

                  <div id="multi_mats_tables"></div>

                  <div class="row mb-3">
                    <label class="form-label" id="multi_result_span"></label>
                  </div>

                  <div id="multi_mats_result"></div>

                  <button
                    type="submit"
                    class="btn btn-primary"
                    onclick="calcMulti()"
                  >
                    Вычислить
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!--Reverse-->
        <div>
          <div class="row">
            <h2 id="reverse">Вычисление обратной матрицы</h2>
            <div class="col">
              <div class="card">
                <div class="card-body">
                  <div class="input-group mb-3">
                    <span class="input-group-text" id="basic-addon1"
                      >Размер матрицы</span
                    >
                    <select
                      class="form-select"
                      aria-label="Размер матрицы"
                      id="reverse_mat_size"
                      for="reverse_mat_table"
                      onchange="fillSquareMat(this)"
                    >
                      <option value="1">1x1</option>
                      <option value="2">2x2</option>
                      <option value="3" selected="selected">3x3</option>
                      <option value="4">4x4</option>
                      <option value="5">5x5</option>
                      <option value="6">6x6</option>
                      <option value="7">7x7</option>
                    </select>
                  </div>

                  <div class="mb-3">
                    <label for="reverse_mat_table" class="form-label"
                      >Матрица</label
                    >
                    <div class="md-0" id="reverse_mat_table"></div>
                  </div>

                  <div class="input-group mb-3">
                    <span class="input-group-text">A<sup>-1</sup></span>
                    <input
                      type="text"
                      id="reverse_result"
                      class="form-control"
                      disabled
                    />

                    <div id="reverse_mat_result"></div>
                    <button
                      type="submit"
                      class="btn btn-primary"
                      onclick="calcReverse()"
                    >
                      Вычислить
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <footer class="footer">
      <div class="container">
        <span class="text-muted"
          >Собственность группы РКБО-01-20. Изготовил сие поделие
          <a href="https://github.com/GreenFantomas">GreenFantomas</a></span
        >
      </div>
    </footer>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
      crossorigin="anonymous"
    ></script>

    <script src="algebra2.js"></script>
    <script src="../gui.js"></script>
    <script src="../wolfram.js"></script>
    <script>
      matInput = `<div class="col md-0"><input id="ID" style="text-align:center;" class="form-control" onclick="$(this).val('')" value="0"></div>`;
      matResult = `<div class="col md-0"><input id="ID" style="text-align:center;" class="form-control" disabled value="RES"></div>`;

      matMultiTemp = `
      <div class="input-group mb-3" id="Amat">
                      <span class="input-group-text"
                        >Размер матрицы A</span
                      >
                      <select
                        class="form-select"
                        aria-label="Размер матрицы A"
                        id="matA_i_size"
                        for="matA_i_table"
                        onchange="resizeMultiMat(this)"
                      >
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3" selected="selected">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                      </select>

                      <span class="input-group-text">x</span>

                      <select
                        class="form-select"
                        aria-label="Размер матрицы A"
                        id="matA_j_size"
                        for="matA_j_table"
                        onchange="resizeMultiMat(this)"
                      >
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3" selected="selected">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                      </select>
                    </div>
                    `;

      matMultiTableTemp = `
      <div class="mb-3">
                      <label for="multi_matA_table" class="form-label"
                        >Матрица A</label
                      >
                      <div class="md-0" id="multi_matA_table"></div>
                    </div>`;
      function fillSquareMat(select) {
        var size = select.value;
        var table = $("#" + select.getAttribute("for"));
        var matTable = "";
        for (var i = 0; i < size; i++) {
          matTable += '<div class="row g-0">';
          for (var j = 0; j < size; j++) {
            matTable += matInput.replaceAll("ID", i + "_" + j);
          }
          matTable += "</div>";
        }
        table.html(matTable);
      }

      function fillMat(table, ik, jk) {
        var matTable = "";
        for (var i = 0; i < ik; i++) {
          matTable += '<div class="row g-0">';
          for (var j = 0; j < jk; j++) {
            matTable += matInput.replaceAll("ID", i + "_" + j);
          }
          matTable += "</div>";
        }
        table.html(matTable);
      }

      function fillMatVal(table, A) {
        var matTable = "";
        for (var i = 0; i < A.length; i++) {
          matTable += '<div class="row g-0">';
          for (var j = 0; j < A[0].length; j++) {
            matTable += matResult
              .replaceAll("ID", i + "_" + j)
              .replaceAll("RES", A[i][j]);
          }
          matTable += "</div>";
        }
        table.html(matTable);
      }

      fillSquareMat(document.getElementById("deter_mat_size"));
      fillSquareMat(document.getElementById("reverse_mat_size"));
      fillSquareMat(document.getElementById("deter_param_mat_size"));

      function calcDet() {
        var size = $("#deter_mat_size").val();
        $("#deter_result").val(det(readMat($("#deter_mat_table"), size, size)));
      }

      function readMat(parent, ik, jk) {
        var A = [];
        for (var i = 0; i < ik; i++) {
          A[i] = [];
          for (var j = 0; j < jk; j++) {
            A[i][j] = parseFloat(parent.find("#" + i + "_" + j).val());
            if (isNaN(A[i][j])) A[i][j] = 0;
          }
        }
        return A;
      }

      function readRawMat(parent, ik, jk) {
        var A = [];
        for (var i = 0; i < ik; i++) {
          A[i] = [];
          for (var j = 0; j < jk; j++) {
            A[i][j] = parent.find("#" + i + "_" + j).val();
          }
        }
        return A;
      }

      function fillMultiMats(element) {
        var size = parseInt(element.value);
        var field = $("#" + element.getAttribute("for"));
        var insert = matMultiTemp;
        var insertTable = matMultiTableTemp;
        var letter = "A";
        for (i = 66; i < 65 + size; i++) {
          insert += matMultiTemp.replaceAll("A", "&#" + i);
          insertTable += matMultiTableTemp.replaceAll("A", "&#" + i);
          letter += "*&#" + i;
        }
        field.html(insert);
        $("#multi_mats_tables").html(insertTable);
        $("#multi_result_span").html(letter);

        for (var k = 65; k <= 64 + size; k++) {
          var l = String.fromCharCode(k);
          fillMat($("#multi_mat" + l + "_table"), 3, 3);
        }
      }
      fillMultiMats(document.getElementById("multi_mats_number"));

      function resizeMultiMat(mat_element) {
        var mat = $(mat_element).parent().attr("id")[0];
        var i = $("#mat" + mat + "_i_size").val();
        var j = $("#mat" + mat + "_j_size").val();
        fillMat($("#multi_mat" + mat + "_table"), i, j);
      }

      function calcMulti() {
        var size = $("#multi_mats_number").val();
        var arr = [];
        var multi = [];
        for (a = 0; a < size; a++) {
          var l = String.fromCharCode(a + 65);
          arr[a] = readMat(
            $("#multi_mat" + l + "_table"),
            $("#mat" + l + "_i_size").val(),
            $("#mat" + l + "_j_size").val()
          );
          if (a > 0) {
            try {
              multi = matMulti(multi, arr[a]);
            } catch (e) {
              alert(e);
              return;
            }
          } else {
            multi = arr[a];
          }
        }
        multi;
        fillMatVal($("#multi_mats_result"), multi);
      }

      function calcReverse() {
        var size = $("#reverse_mat_size").val();
        var A = readMat($("#reverse_mat_table"), size, size);
        var d = det(A);
        if (d >= 0) {
          $("#reverse_result").val("1/" + det(A));
        } else {
          $("#reverse_result").val("-1/" + -1 * det(A));
        }
        fillMatVal($("#reverse_mat_result"), algDop(trans(A)));
      }

      function calcDetWithParam() {
        var size = $("#deter_param_mat_size").val();
        var A = readRawMat($("#deter_param_mat_table"), size, size);
        var res = $("#deter_param_result").val();
        detParamRedirect(A, res);
      }
    </script>
  </body>
</html>
